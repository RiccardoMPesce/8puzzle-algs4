Possible improvement: caching the content of some repeated computations
